## AI change log

- [2025-11-27T00:00:00Z] src/reducers/treeReducer.ts — Fix child visibility bug by ensuring parent nodes have isOpen:true when children are added; updated both POST-PERSON action and postPersonTC thunk to automatically open parent nodes when new children are created.
- [2025-11-27T00:00:00Z] src/components/NewNode/NewNode.tsx — Remove sex-based filter (node.sex !== 'male') from children rendering logic so all nodes display their children regardless of gender when isOpen is true.
- [2025-11-27T09:00:00Z] src/components/NewNode/NewNode.tsx — Add minWidth:0 to parent name display div, enabling proper text ellipsis truncation when first or last names exceed available width in flex container.
- [2025-11-27T09:01:00Z] src/components/NewNode/Node.module.css — Add text ellipsis to main node h3 name display and create member-details class with minWidth:0, prevents long names from breaking card layout.
- [2025-11-27T09:02:00Z] src/components/NewNode/NewNode.tsx — Wrap parent and main node names with Tooltip components showing full name on hover when text is truncated with ellipsis.
- [2025-11-27T18:15:00Z] src/components/NewNode/NewNode.tsx — Replace edit NavLink with modal popup form; add useState for edit modal state, Form with all person fields (name, sex, DOB, phone, address, parent), and handleEditClick/handleEditSubmit handlers to update person inline without navigation.
- [2025-11-27T18:30:00Z] src/components/NewNode/EditPersonModal.tsx — Create standalone modal component for editing person with full form fields and update logic extracted from NewNode.
- [2025-11-27T18:30:00Z] src/components/NewNode/AddChildModal.tsx — Create standalone modal component for adding child to parent node with form handling child creation and parent linking.
- [2025-11-27T18:30:00Z] src/components/NewNode/AddParentModal.tsx — Create standalone modal component for adding parent to child node with relationship selection (father/mother/step) and spouse linking logic.
- [2025-11-27T18:30:00Z] src/components/NewNode/NewNode.tsx — Decompose all three action icons (edit, add child, add parent) to use popup modals instead of page navigation; replace NavLinks with clickable spans, extract modal logic to separate components, manage three modal states independently.
- [2025-11-27T19:00:00Z] src/components/NewNode/AddSpouseModal.tsx — Create standalone modal component for adding spouse with form handling spouse creation and spouseId linking to target person node.
- [2025-11-27T19:00:00Z] src/components/NewNode/NewNode.tsx — Add fourth icon popup for adding spouse with HeartOutlined icon, state management for spouse modal visibility, and handleAddSpouseClick handler integrated into edit-icon section.
- [2025-11-27T19:00:00Z] src/components/NewNode/Node.module.css — Extend hover effects to span elements in edit-icon, ensures all icon buttons (not just anchors) have consistent hover styling with color/transform/shadow transitions.
- [2025-11-27T19:15:00Z] src/components/NewNode/AddSpouseModal.tsx — Fix bidirectional spouse relationship by updating existing person to point back to new spouse after creation, prevents one-way spouse links.
- [2025-11-27T19:15:00Z] (4 files) src/components/NewNode/AddChildModal.tsx, AddParentModal.tsx, AddSpouseModal.tsx, EditPersonModal.tsx — Remove redundant getTreeTC() calls after create/update operations; postPersonTC and updatePersonTC already update Redux state correctly, extra reload from localStorage was causing state inconsistency and preventing new nodes from appearing.
- [2025-11-27T19:30:00Z] src/components/NewNode/AddSpouseModal.tsx — Set new spouse parentId to match their partner's parentId so spouses appear as siblings in tree structure instead of appearing as separate root nodes.
- [2025-11-27T19:35:00Z] src/data/mockData.ts — Deleted mock data file; user opted to remove initial seed data, family tree will now start empty or rely on localStorage data only.
- [2025-11-27T19:35:00Z] src/reducers/treeReducer.ts — Remove mockData import, inline LOCAL_STORAGE_KEY and generateId constants, getTreeTC now returns empty array instead of initialMockData on first load.
- [2025-11-27T20:00:00Z] src/components/NewNode/NewNode.tsx — Group spouses in single tile by tracking rendered spouse IDs, conditionally using member-image-couple class, and rendering both people side-by-side with heart divider; prevents duplicate spouse nodes in tree display.
- [2025-11-27T20:00:00Z] src/components/NewNode/Node.module.css — Add member-image-couple, couple-container, person-in-couple, and spouse-divider styles to display two spouses horizontally in one shared card with heart icon separator between them.
- [2025-11-27T20:15:00Z] src/components/NewNode/NewNode.tsx — Fix children not appearing immediately by merging children arrays from both spouses when rendering couples; now checks both node.isOpen and spouse.isOpen to determine if children should be displayed, resolves issue where spouse's children were lost.
- [2025-11-27T20:20:00Z] src/components/NewNode/Node.module.css — Make couple card narrower: reduce min-width from 340px to 280px, add max-width 320px, reduce padding, decrease avatar size from 80px to 70px, reduce gaps and font sizes for more compact couple tile layout.
- [2025-11-27T20:25:00Z] src/components/NewNode/NewNode.tsx — Add "Spouse" badge above spouse avatar to clearly indicate which person was added as spouse versus tile owner who was created first.
- [2025-11-27T20:25:00Z] src/components/NewNode/Node.module.css — Add spouse-badge styles with red gradient background, positioned absolutely at top of spouse avatar, and set person-in-couple to position relative for badge positioning.
- [2025-11-27T20:30:00Z] src/components/NewNode/NewNode.tsx — Disable "Add Spouse" button when spouse already exists and disable "Add Parent" button when person already has 2 parents; buttons show visual feedback with reduced opacity and not-allowed cursor, with updated tooltip messages.
- [2025-11-27T20:35:00Z] src/components/NewNode/EditPersonModal.tsx — Add spouse management: display spouse info card with Edit and Remove buttons, toggle between person/spouse editing modes, implement delete spouse with Popconfirm, remove bidirectional spouseId relationships on delete, all within edit person modal without additional icons.
- [2025-11-27T20:36:00Z] src/components/NewNode/EditPersonModal.tsx — Fix Popconfirm TypeScript error by removing unsupported description prop, combine confirmation message into title prop for compatibility with current Ant Design version.
- [2025-11-27T21:30:00Z] src/components/NewNode/EditPersonModal.tsx — Fix bug where spouse form fields were overwritten with main person's data by useEffect hook; prevent useEffect from resetting form when editingSpouse mode is active, ensuring spouse updates don't accidentally rename spouse to main person.
- [2025-11-27T22:00:00Z] src/components/NewNode/NewNode.tsx — Move parent display inside person-in-couple div so parents only show under the main person (not spouse) in couple cards; add isInCouple parameter to renderParentsDirectly to render narrower parent cards with smaller avatars (22px vs 28px), tighter padding, and smaller font (8px vs 10px) when displayed within couple layout.
- [2025-11-27T22:30:00Z] src/components/NewNode/NewNode.tsx — Fix duplicate spouse nodes appearing when creating parent by passing renderedSpouseIds Set through recursive NewNode calls; prevents same couple from rendering multiple times at different tree levels since Set now tracks rendered spouses across entire tree instead of per-component-instance.
- [2025-11-27T23:00:00Z] src/reducers/treeReducer.ts — Add logic to filter root nodes in tree construction; created buildTree helper to exclude spouse nodes from root level if they are partners of children (already rendered deep in tree) or if they are partners of other roots (preventing duplicate couple display), resolving issue where spouses appeared as separate root nodes.
- [2025-11-27T23:15:00Z] src/components/NewNode/AddParentModal.tsx — Populate childrenId field when adding parent to a child; previously set to null, now correctly links to the existing child node to maintain bidirectional relationship data, although UI relies on parentId.
- [2025-11-27T23:15:00Z] src/components/NewNode/AddChildModal.tsx — Update parent's childrenId field when adding a new child; added updatePersonTC dispatch to link parent back to the new child, ensuring data consistency for childrenId field even if primary tree construction uses parentId.
